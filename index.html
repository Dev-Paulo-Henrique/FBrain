<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Import TensorFlow.js library -->
    <title>Document</title>
    <style>
        video, #canvas, svg{
            position: absolute;
        }
        svg, path{
            display: flex;
            margin-left: 5%;
            margin-top: 2.5%;
        }
        #secondcanvas{
            max-width: 320px;
        }
    </style>
</head>
<body>
    <video id="video" width="320" height="240" autoplay preload loop muted></video>
    <!-- style="filter: grayscale(100%);" -->
    <!--<svg id="svg" xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-maximize">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
        </path>
    </svg>-->
    <canvas id="canvas" width="320" height="240"></canvas>
    <canvas id="secondcanvas"></canvas>
    <script src="./script.js"></script>
    <img id="photoPreview"/>
    <script src="tracking-min.js"></script>
    <script src="data/face-min.js"></script>
    <script>
        function init(){
            const video = document.getElementById('video')
            const canvas = document.getElementById('canvas')
            const svg = document.getElementById('svg')
            const context = canvas.getContext('2d')
            var audio = new Audio('https://toqueparacelular.com/wp-content/uploads/2021/03/Redmi-New-Massage.mp3');
            const tracker = new tracking.ObjectTracker('face')
            var secondcanvas = document.querySelector('#secondcanvas');
            var secondcontext = secondcanvas.getContext('2d');
            var link = document.createElement('a');
            tracking.track('#video', tracker, {camera: true})
            tracker.on('track', event => {
                // console.log(event)
                context.clearRect(0,0,canvas.width, canvas.height)
                event.data.forEach(rect => {
                    // console.log(rect)
                    context.strokeStyle = '#ff0000'
                    context.lineWidth = 2
                    context.strokeRect(rect.x, rect.y, rect.width, rect.height)
                    context.fillText(`x: ${rect.x}, w: ${rect.width}`, rect.x + rect.width + 10, rect.y + 10 )
                    context.fillText(`y: ${rect.y}, h: ${rect.height}`, rect.x + rect.width + 10, rect.y + 20 )
                    console.log('rosto encontrado')
                    if(rect.width < 100 && rect.height < 100){
                        context.fillText('Aproxime-se', rect.x + rect.width + 10, rect.y + 30)
                    }else{
                        context.fillText('Pare!', rect.x + rect.width + 10, rect.y + 30)
                    }
                    if(rect.x < 90){
                        context.fillText('Mova-se para a esquerda', rect.x + rect.width + 10, rect.y + 40)
                    }else{
                        context.fillText('Pare!', rect.x + rect.width + 10, rect.y + 40)
                    }
                    if(rect.y < 70){
                        context.fillText('Mova-se para baixo', rect.x + rect.width + 10, rect.y + 50)
                    }else{
                        context.fillText('Pare!', rect.x + rect.width + 10, rect.y + 50)
                    }
                    if(rect.width >= 100 && rect.height >= 100 && rect.x >= 90 && rect.y >= 70){
                        secondcanvas.height = video.videoHeight;
                        secondcanvas.width = video.videoWidth;
                        secondcontext.drawImage(video, 0, 0);
                        audio.play();
                        video.style.display = 'none'
                        canvas.style.display = 'none'
                        svg.style.display = 'none'
                        link.download = 'Aluno.png';
                        link.href = secondcanvas.toDataURL();
                        document.body.appendChild(link.click());
                    }
                })
            })
        }
        window.onload = init()
    </script>
</body>
</html>
